<div id="main" class="lift:surround?with=default&at=content">

	<h2>Article</h2>
	<div id="map_canvas" style="width: 500px; height: 300px"></div>
	<div>
		<div class="lift:ShowArticle">
			<span class="title"></span>
			<span class="article"></span>
			<span class="username"></span>
			<span class="date"></span>
			<span class="lat"></span>
			<span class="lng"></span>

		</div>
	</div>
	<div>
		<div class="lift:AddArticle?form=post">
			Title:
			<input name="title" id="the_title">
			</input>
			<br/>
			Category:
			<select name="category" id="the_category">
			</select>
			<br/>
			Article: 
			<textarea name="article" id="the_article" ></textarea>
			<br/>
			lat:
			<input name="lat" value="0.0" id="the_lat">
			</input>
			<br/>
			lng:
			<input name="lng" value="0.0" id="the_lng">
			</input>
			<br/>

			<input type="submit" value="Submit">
			</input>
		</div>
	</div>
	
	
   <div class="lift:CommentArticleSnippet.listMessages"> </div>	
   <div>
		<div class="lift:CommentArticleSnippet">
			<span id="message"> </span>
			<span id="send"></span>

		</div>
	</div>
	


	<script type="text/javascript">
		function initialize() {
			var latStr = "";
			var lngStr = "";
			$(document).ready(function() {
				latStr = $(".lat").text();
				lngStr = $(".lng").text();
			});
			var latFloat = parseFloat(latStr);
			var lngFloat = parseFloat(lngStr);
			if (!isNaN(latFloat) && !isNaN(lngFloat)) {
				var mapOptions = {
					zoom : 4,
					center : new google.maps.LatLng(latFloat, lngFloat),
					mapTypeId : google.maps.MapTypeId.ROADMAP
				};

				var map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);

				var marker = new google.maps.Marker({
					position : map.getCenter(),
					map : map,
					title : 'Click to zoom',
					icon : 'images/beachflag.png'
				});

				google.maps.event.addListener(map, 'center_changed', function() {
					// 3 seconds after the center of the map has changed, pan back to the
					// marker.
					window.setTimeout(function() {
						map.panTo(marker.getPosition());
					}, 3000);
				});

				google.maps.event.addListener(marker, 'click', function() {
					map.setZoom(8);
					map.setCenter(marker.getPosition());
				});
			} else {
				var marker;

				var mapOptions = {
					center : new google.maps.LatLng(-34.397, 150.644),
					zoom : 8,
					mapTypeId : google.maps.MapTypeId.ROADMAP
				};

				var map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
				function placeMarker(location) {
					if (marker) {
						marker.setPosition(location);
					} else {
						marker = new google.maps.Marker({
							position : location,
							map : map,
							icon : 'images/beachflag.png'

						});
					}
				}


				google.maps.event.addListener(map, 'click', function(event) {
					document.getElementById('the_lat').value = event.latLng.lat();
					document.getElementById('the_lng').value = event.latLng.lng();
					//alert(event.latLng.lat()+" "+event.latLng.lng())
					placeMarker(event.latLng);
				});

			}

			google.maps.event.addDomListener(window, 'load', initialize);
		}
	</script>
</div>
