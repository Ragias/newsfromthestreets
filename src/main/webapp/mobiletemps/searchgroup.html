<div >

	<div class="lift:ShowSearchGroup"></div>


	<div class="lift:SearchGroupMessenger">
		<span id="message"> </span>
		<span id="send"></span>
	</div>

	<div class="lift:AddSearchGroupSnippet?form=post">
		Name:
		<input name="name" id="the_name">
		</input>
		<br/>

		Description:
		<textarea name="description" id="the_description" ></textarea>
		<br/>

		<input type="submit" value="Submit">
		</input>
	</div>

	<div class="lift:AdminSearchGroup?form=post">
		Name:
		<input name="name" id="the_name">
		</input>
		<br/>

		Description:
		<textarea name="description" id="the_description" ></textarea>
		<br/>

		<input type="submit" value="Submit">
		</input>
	</div>
	<script>
		var map;
		var markerArr = new Array();

		function showListOfGroupMessages() {
			var id = getParameterByName("id")
			if(id){
			$.getJSON("/api/newsfromthestreets/searchgroupmessenger/" + id + "/" + getParameterByName("num"), function(json) {
				$('#listOfGroupMessages').empty();
				for (var i = 0; i <= json.length - 1; i++) {
					$('#listOfGroupMessages').append($('<li>').append($('<span>').append(json[i].username + " : " + json[i].message)));
				}
			});
			setTimeout(arguments.callee, 1000);
			}
		}

		function initialize() {
			var greece = {
				'lat' : 38.01861070670554,
				'lng' : 23.625567382812505
			}

			var watch;
			var mapOptions = {
				center : new google.maps.LatLng(greece.lat, greece.lng),
				zoom : 6,
				mapTypeId : google.maps.MapTypeId.ROADMAP
			};
			map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
			// Try HTML5 geolocation

			var checkJson = (function() {
				var searchGroupStr = getParameterByName("id");
				if(searchGroupStr){
				$.getJSON("/api/newsfromthestreets/searchgroup/" + searchGroupStr, function(json) {

					if (json.length > 0) {
						for ( i = 0; i < json.length; i++) {
							var location = json[i];
							addMarker(location);
						}
					}
					if (json.length < markerArr.length) {
						if (!markerArr.isEmpty) {
							while (markerArr[0]) {
								markerArr.pop().setMap(null);
							}
						}
					}

				});

				setTimeout(arguments.callee, 1000);
				}
			});
			checkJson();

			function addMarker(location) {

				var check = false;
				for ( i = 0; i < markerArr.length; i++) {

					if (markerArr[i].id == location.id) {
						check = true;

						if (location.latlng.lat == markerArr[i].position.lat() && location.latlng.long == markerArr[i].position.lng()) {
							break;
						}
						var point = new google.maps.LatLng(location.latlng.lat, location.latlng.long);

						var marker = new google.maps.Marker({
							position : point,
							map : map,
							title : location.username,
							id : location.id
						});
						markerArr[i].setMap(null)
						markerArr[i] = marker;
						break;
					}
				}
				if (!check) {
					//console.log(location.title)
					var point = new google.maps.LatLng(location.latlng.lat, location.latlng.long);

					var marker = new google.maps.Marker({
						position : point,
						map : map,
						title : location.username,
						id : location.id
					});
					markerArr.push(marker);
				}

			};
		};
		function getParameterByName(name) {
			name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
			var regexS = "[\\?&]" + name + "=([^&#]*)";
			var regex = new RegExp(regexS);
			var results = regex.exec(window.location.search);
			if (results == null)
				return "";
			else
				return decodeURIComponent(results[1].replace(/\+/g, " "));
		};

		google.maps.event.addDomListener(window, 'load', initialize);
		showListOfGroupMessages();
	</script>
</div>